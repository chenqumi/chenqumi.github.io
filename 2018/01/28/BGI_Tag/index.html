<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="这是一个很懒的人，但这个人也开始想做点什么了···"><title>Tag拼接练习题 | 大海</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Tag拼接练习题</h1><a id="logo" href="/.">大海</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Tag拼接练习题</h1><div class="post-meta">Jan 28, 2018<span> | </span><span class="category"><a href="/categories/Bioinfo/">Bioinfo</a></span></div><a class="disqus-comment-count" data-disqus-identifier="2018/01/28/BGI_Tag/" href="/2018/01/28/BGI_Tag/#disqus_thread"></a><div class="post-content"><h3 id="写给半山"><a href="#写给半山" class="headerlink" title="写给半山"></a>写给半山</h3><h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><p>如有侵权，请联系(QQ:993860057)删除。</p>
<p>这是师弟入职后的一道练习题，个人认为是很适合生信新人的。一位好友提起想要入门生物信息，就把这道题给他了，希望他能看到这篇博文并对他有所帮助。</p>
<p>题目如下：</p>
<p><img src="/images/BGI_Tag.problem.png" alt="problem"></p>
<h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><h4 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h4><p>个人认为此题考查点为：</p>
<ol>
<li>测序原理：插入片段大小、read1和read2是如何得到的</li>
<li>FastQ和Fasta格式</li>
<li>编程能力</li>
</ol>
<h4 id="第1、2小题"><a href="#第1、2小题" class="headerlink" title="第1、2小题"></a>第1、2小题</h4><p>这道题难点主要在第3问所以主要讲该问的解法。第1、2问中由于是按窗口进行评价，所以需要注意在计算窗口数目时存在一个向上取整的问题。</p>
<h4 id="第3小题"><a href="#第3小题" class="headerlink" title="第3小题"></a>第3小题</h4><p>首先需要知道read1和read2是怎么来的，如图所示：</p>
<p><img src="/images/BGI_Tag.reads.jpg" alt="reads"></p>
<p>对于一段序列CGTGCGGGGGATTGCCCGGGATCTG来说，如果读长是20bp，则reads1是5’-3’的20 bp base，read2则是3’-5’的20 bp base。如果对read1和read2进行tag拼接，则需要先将read2反转得到read2_reverse，然后根据overlap关系进行拼接。</p>
<p><strong>拼接方法</strong>：</p>
<p><img src="/images/BGI_Tag.tag.jpg" alt="tag"></p>
<p>仍以上述序列为例，reads读长为20 bp，要求的最小match数为10，允许的错误率为0.3。</p>
<p>read1记为r1，read2反转后记为r2_r，实际的match数记为m，</p>
<ol>
<li><p>先将read2反转。</p>
</li>
<li><p>根据题意，有最小match数要求，也就是说如果能够成功拼接，则最小的overlap为10 bp，其中的错误数&lt;=允许的最大错误数，因此将初始的m设为10，然后检查m这段区域内r1和r2_r的碱基匹配情况。</p>
</li>
<li><p>如果为拼接不成功，则m+1，再次尝试拼接。</p>
</li>
<li><p>结束条件为拼接成功或直到m == min(r1, r2_r)，即下图的情况。</p>
<p><img src="/images/BGI_Tag.readlen.jpg" alt="readlen"></p>
<p><strong>注意</strong>：由于第1、2问中可能因为数据质量的原因截去部分碱基，所以用于拼接tag的reads长度可能不一样</p>
</li>
</ol>
<h3 id="伪码描述"><a href="#伪码描述" class="headerlink" title="伪码描述"></a>伪码描述</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">for step in range(min_match,min(r1,r2_r)):  #外循环遍历所有的match情况,从最小match数开始</span><br><span class="line">	for i in ranger(0,m-1):        #内循环检查m区域内r1和r2_r对应碱基是否匹配</span><br><span class="line">		记录错误数</span><br><span class="line">		if 错误数 &gt; 允许的错误数:</span><br><span class="line">			break</span><br><span class="line">	if 错误数 &gt; 允许的错误数:</span><br><span class="line">		m += 1</span><br><span class="line">		错误数归零</span><br><span class="line">	else：</span><br><span class="line">		拼接tag</span><br><span class="line">		# 如果能够拼接成tag的话，则tag由3部分组成：</span><br><span class="line">		# 1. r1-ovarlap的部分</span><br><span class="line">		# 2. overlap</span><br><span class="line">		# 3. r2_r-overlap的部分</span><br><span class="line">		break</span><br></pre></td></tr></table></figure>
<h3 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ==================================</span></span><br><span class="line">parser = argparse.ArgumentParser(description=</span><br><span class="line">    <span class="string">"Filter reads and Joint MaxLenTagTag"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"-r1"</span>,dest=<span class="string">"read1"</span>,required=<span class="keyword">True</span>,</span><br><span class="line">    help=<span class="string">"input read1"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"-r2"</span>,dest=<span class="string">"read2"</span>,required=<span class="keyword">True</span>,</span><br><span class="line">    help=<span class="string">"input read2"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"-w"</span>,dest=<span class="string">"window"</span>,type=int,default=<span class="number">50</span>,</span><br><span class="line">    help=<span class="string">"window size when stat qual [50]"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"-c"</span>,dest=<span class="string">"cut_ratio"</span>,type=float,default=<span class="number">0.3</span>,</span><br><span class="line">    help=<span class="string">"cut ratio threshold [0.3]"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"-n"</span>,dest=<span class="string">"N_ratio"</span>,type=float,default=<span class="number">0.1</span>,</span><br><span class="line">    help=<span class="string">"N ratio threshold [0.1]"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"-match"</span>,dest=<span class="string">"min_match"</span>,type=int,default=<span class="number">50</span>,</span><br><span class="line">    help=<span class="string">"minimum match number [50]"</span>)</span><br><span class="line">parser.add_argument(<span class="string">"-mr"</span>,dest=<span class="string">"mismatch_ratio"</span>,type=float,default=<span class="number">0.1</span>,</span><br><span class="line">    help=<span class="string">"max mismatch ratio [0.1]"</span>)</span><br><span class="line"></span><br><span class="line">args = parser.parse_args()</span><br><span class="line">read1 = args.read1</span><br><span class="line">read2 = args.read2</span><br><span class="line">window = args.window</span><br><span class="line">cut_ratio = args.cut_ratio</span><br><span class="line">N_ratio = args.N_ratio</span><br><span class="line">min_match = args.min_match</span><br><span class="line">mismatch_ratio = args.mismatch_ratio</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ==================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FilterLowQual</span><span class="params">(qual,seq_length,phred=<span class="number">33</span>)</span>:</span></span><br><span class="line">    </span><br><span class="line">    index = seq_length</span><br><span class="line">    <span class="comment"># python3 syntax</span></span><br><span class="line">    <span class="comment">#times = math.ceil(seq_length/window)</span></span><br><span class="line">    <span class="comment"># python2 syntax</span></span><br><span class="line">    times = int((seq_length+window<span class="number">-1</span>)/window)</span><br><span class="line">    qual_r = qual[::<span class="number">-1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(times):</span><br><span class="line">        </span><br><span class="line">        start = window * i</span><br><span class="line">        end = start + window</span><br><span class="line">        sum_qual = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        win_len = len(qual_r[start:end])</span><br><span class="line">        <span class="keyword">for</span> base_qual <span class="keyword">in</span> qual_r[start:end]:</span><br><span class="line">            base_qual = ord(base_qual) - phred</span><br><span class="line">            sum_qual += base_qual</span><br><span class="line">        </span><br><span class="line">        mean_qual = sum_qual/win_len</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mean_qual &lt; <span class="number">20</span>:</span><br><span class="line">            index = seq_length - window*(i+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    qual_filter_len = len(qual[:index])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> qual_filter_len,index</span><br><span class="line">    </span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ==================================</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">FilterN</span><span class="params">(seq)</span>:</span></span><br><span class="line"></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> base <span class="keyword">in</span> seq:</span><br><span class="line">        <span class="keyword">if</span> base == <span class="string">"N"</span> <span class="keyword">or</span> base == <span class="string">"n"</span>:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">    seqNratio = count/len(seq)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> seqNratio &gt; N_ratio:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ==================================</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MaxLenTag</span><span class="params">(seq1,seq2,qual1,qual2,id1,id2)</span>:</span></span><br><span class="line">    seq2_r = seq2[::<span class="number">-1</span>]</span><br><span class="line">    qual2_r = qual2[::<span class="number">-1</span>]</span><br><span class="line">    <span class="comment">#marker = seq2_r[:min_match]</span></span><br><span class="line">    max_mismatch_num = int(mismatch_ratio * min_match)</span><br><span class="line">    seq1_len = len(seq1)</span><br><span class="line">    seq2_len = len(seq2)</span><br><span class="line"></span><br><span class="line">    mismatch_num = <span class="number">0</span></span><br><span class="line">    tag_num = <span class="number">0</span></span><br><span class="line">    tag_len = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    match_len = min_match</span><br><span class="line"></span><br><span class="line">    fq_hd = open(<span class="string">"MaxLenTag.fastq"</span>,<span class="string">"aw"</span>)</span><br><span class="line">    fa_hd = open(<span class="string">"MaxLenTag.fasta"</span>,<span class="string">"aw"</span>)</span><br><span class="line"></span><br><span class="line">    min_seq_len = min(seq1_len,seq2_len) <span class="comment"># max step!!!</span></span><br><span class="line">    <span class="keyword">for</span> step <span class="keyword">in</span> range(min_seq_len-min_match + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(match_len):</span><br><span class="line">            <span class="keyword">if</span> seq1[seq1_len-match_len+i] != seq2_r[i]:</span><br><span class="line">                mismatch_num += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> mismatch_num &gt; max_mismatch_num:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mismatch_num &gt; max_mismatch_num:</span><br><span class="line">            match_len += <span class="number">1</span></span><br><span class="line">            mismatch_num = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            tag_num = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            tag1 = seq1[:seq1_len-match_len]</span><br><span class="line">            tag1_qual = qual1[:seq1_len-match_len]</span><br><span class="line">            <span class="comment">#tag2 = overlap</span></span><br><span class="line">            seq1_match = seq1[seq1_len-match_len:]</span><br><span class="line">            qual1_match = qual1[seq1_len-match_len:]</span><br><span class="line">            seq2_match = seq2_r[:match_len]</span><br><span class="line">            qual2_match = qual2_r[:match_len]</span><br><span class="line">            tag2= <span class="string">""</span></span><br><span class="line">            tag2_qual = <span class="string">""</span></span><br><span class="line">            <span class="keyword">for</span> base <span class="keyword">in</span> range(len(seq1_match)):</span><br><span class="line">                <span class="keyword">if</span> ord(qual1_match[base]) &gt;= ord(qual2_match[base]):</span><br><span class="line">                    tag2 += seq1_match[base]</span><br><span class="line">                    tag2_qual += qual1_match[base]</span><br><span class="line">                <span class="keyword">else</span> :</span><br><span class="line">                    tag2 += seq2_match[base]</span><br><span class="line">                    tag2_qual += qual2_match[base]</span><br><span class="line"></span><br><span class="line">            tag3 = seq2_r[match_len:]</span><br><span class="line">            tag3_qual = qual2_r[match_len:]</span><br><span class="line">            </span><br><span class="line">            tag = tag1 + tag2 + tag3</span><br><span class="line">            tag_qual = tag1_qual + tag2_qual + tag3_qual</span><br><span class="line">            tag_len = len(tag)</span><br><span class="line">            </span><br><span class="line">            fq_hd.write(<span class="string">"@&#123;&#125;\n"</span>.format(id1))</span><br><span class="line">            fq_hd.write(tag+<span class="string">"\n"</span>)</span><br><span class="line">            fq_hd.write(<span class="string">"+\n"</span>)</span><br><span class="line">            fq_hd.write(tag_qual+<span class="string">"\n"</span>)</span><br><span class="line">            fa_hd.write(<span class="string">"&gt;&#123;&#125;\n"</span>.format(id1))</span><br><span class="line">            fa_hd.write(tag+<span class="string">"\n"</span>)</span><br><span class="line">            </span><br><span class="line">            match_len += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    fq_hd.close()</span><br><span class="line">    fa_hd.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tag_num,tag_len</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ==================================</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">TagLengthStat</span><span class="params">(lst)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        mean = sum(lst)/len(lst)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        mean = <span class="number">0</span></span><br><span class="line">    variance = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> lst:</span><br><span class="line">        variance += (i-mean)**<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        variance = variance/len(lst)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        variance = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        std = math.sqrt(variance)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        std = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mean,std</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ==================================</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">OpenFile</span><span class="params">(fastq)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> fastq.endswith(<span class="string">".gz"</span>):</span><br><span class="line">        fastq_fd = gzip.open(fastq)</span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        fastq_fd = open(fastq)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> fastq_fd</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ==================================</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    </span><br><span class="line">    rd1_fd = OpenFile(read1)</span><br><span class="line">    rd2_fd = OpenFile(read2)</span><br><span class="line">    </span><br><span class="line">    reads_num = <span class="number">0</span></span><br><span class="line">    tag_num = <span class="number">0</span></span><br><span class="line">    tag_lst = []</span><br><span class="line">    <span class="comment">#tag_len_fd = open ("TagLengthStat.txt","w")</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> rd1_fd:</span><br><span class="line">        </span><br><span class="line">        reads_num += <span class="number">1</span></span><br><span class="line">        <span class="comment"># read1</span></span><br><span class="line">        head1 = line.strip()</span><br><span class="line">        rd1_id = head1.split(<span class="string">"@"</span>)[<span class="number">1</span>]</span><br><span class="line">        seq1 = rd1_fd.next().strip()</span><br><span class="line">        rd1_fd.next().strip()</span><br><span class="line">        qual1 = rd1_fd.next().strip()</span><br><span class="line">        seq1_length = len(seq1)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># read2</span></span><br><span class="line">        head2 = rd2_fd.readline().strip()</span><br><span class="line">        rd2_id = head2.split(<span class="string">"@"</span>)[<span class="number">1</span>]</span><br><span class="line">        seq2 = rd2_fd.readline().strip()</span><br><span class="line">        rd2_fd.readline()</span><br><span class="line">        qual2 = rd2_fd.readline().strip()</span><br><span class="line">        seq2_length = len(seq2)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Filter low qual</span></span><br><span class="line">        qual_filter_len1,index1 = FilterLowQual(qual1,seq1_length)</span><br><span class="line">        qual_filter_len2,index2 = FilterLowQual(qual2,seq2_length)</span><br><span class="line">        len_ratio1 = qual_filter_len1/seq1_length</span><br><span class="line">        len_ratio2 = qual_filter_len2/seq2_length</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len_ratio1 &lt; cut_ratio <span class="keyword">or</span> len_ratio2 &lt; cut_ratio:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        seq1_filterlow = seq1[:index1]</span><br><span class="line">        qual1_filterlow = qual1[:index1]</span><br><span class="line">        seq2_filterlow = seq2[:index2]</span><br><span class="line">        qual2_filterlow = qual2[:index2]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Filter N</span></span><br><span class="line">        <span class="keyword">if</span> FilterN(seq1_filterlow) == <span class="number">1</span> <span class="keyword">or</span> FilterN(seq2_filterlow) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Tag</span></span><br><span class="line">        <span class="keyword">if</span> len(seq1_filterlow) &lt; min_match <span class="keyword">or</span> len(seq2_filterlow) &lt; min_match:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        combinetag,tag_len = MaxLenTag(seq1_filterlow,seq2_filterlow,</span><br><span class="line">                             qual1_filterlow,qual2_filterlow,rd1_id,rd2_id)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> combinetag == <span class="number">0</span>:</span><br><span class="line">            combinetag,tag_len = MaxLenTag(seq2_filterlow,seq1_filterlow,</span><br><span class="line">                                 qual2_filterlow,qual1_filterlow,rd2_id,rd1_id)</span><br><span class="line">        </span><br><span class="line">        tag_num += combinetag</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> tag_len != <span class="number">-1</span>:</span><br><span class="line">            <span class="comment">#tag_len_fd.write(tag_len+"\n")</span></span><br><span class="line">            tag_lst.append(tag_len)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    rd1_fd.close()</span><br><span class="line">    rd2_fd.close()</span><br><span class="line">    tag_ratio = tag_num/reads_num</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Read number\t&#123;&#125;"</span>.format(reads_num))</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Tag number\t&#123;&#125;"</span>.format(tag_num))</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Tag ratio\t&#123;&#125;"</span>.format(tag_ratio))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Tag stat</span></span><br><span class="line">    tag_len_fd = open (<span class="string">"TagLengthStat.txt"</span>,<span class="string">"w"</span>)</span><br><span class="line">    mean,std = TagLengthStat(tag_lst)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tag_lst:</span><br><span class="line">        tag_len_fd.write(str(i)+<span class="string">"\n"</span>)</span><br><span class="line">    </span><br><span class="line">    tag_len_fd.write(<span class="string">"mean\t&#123;&#125;\n"</span>.format(mean))</span><br><span class="line">    tag_len_fd.write(<span class="string">"std\t&#123;&#125;\n"</span>.format(std))</span><br><span class="line">    tag_len_fd.close()</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># ==================================</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/python/">python</a><a href="/tags/coding/">coding</a></div><div class="post-nav"><a class="pre" href="/2018/01/29/ABBA-BABA/">D-statistic (ABBA-BABA test) 计算</a><a class="next" href="/2018/01/25/Perceptron/">机器学习基石作业一</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论 「请确保 disqus.com 可以正常加载」</button></div><script>var disqus_shortname = 'lespior';
var disqus_identifier = '2018/01/28/BGI_Tag/';
var disqus_title = 'Tag拼接练习题';
var disqus_url = 'http://yoursite.com/2018/01/28/BGI_Tag/';
$('.btn_click_load').click(function() {
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
  $('.btn_click_load').css('display','none');
});
$.ajax({
  url: 'https://disqus.com/next/config.json',
  timeout: 3000,
  type: 'GET',
  success: (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    $('.btn_click_load').css('display','none');
  })(),
  error: function() {
    $('.btn_click_load').css('display','block');
  }
});</script><script id="dsq-count-scr" src="//lespior.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Bioinfo/">Bioinfo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ML/">ML</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/ABBA-BABA/" style="font-size: 15px;">ABBA-BABA</a> <a href="/tags/D-stat/" style="font-size: 15px;">D-stat</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/coding/" style="font-size: 15px;">coding</a> <a href="/tags/perceptron/" style="font-size: 15px;">perceptron</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/01/29/ABBA-BABA/">D-statistic (ABBA-BABA test) 计算</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/28/BGI_Tag/">Tag拼接练习题</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/25/Perceptron/">机器学习基石作业一</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//lespior.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">大海.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>